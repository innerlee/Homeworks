\clearpage
\section{Adversarial Bandit, Lower Bound} % 5

\textbf{Notation}
\begin{itemize}
    \item $K$ arms.
    \item At time $t$,
        \begin{itemize}
            \item We play arm $I_t$, and at the same time,
                the adversarial select $(g_{1,t}, \dots, g_{K,t})$.
            \item We receive reward $g_{I_t, t}\in[0,1]$.
        \end{itemize}
    \item Define loss $l_{i,t}:=1-g_{i,t}$.
    \item \textbf{Regret}
        \begin{equation}
            R_n := \max_i \sum_{t=1}^n g_{i,t} - \sum_{t=1}^n g_{I_t, t}.
        \end{equation}
    \item \textbf{Expected Regret}
        \begin{equation}
            E[R_n] := E\bigg[\max_i \sum_{t=1}^n g_{i,t}\bigg] - E\bigg[\sum_{t=1}^n g_{I_t, t}\bigg].
        \end{equation}
    \item \textbf{Pseudo-Regret}
        \begin{equation}
            \bar R_n := \max_i \sum_{t=1}^n E[g_{i,t}] - \sum_{t=1}^n E[g_{I_t, t}]
                = \sum_{t=1}^n E[l_{I_t, t}] - \min_i \sum_{t=1}^n E[l_{i,t}].
        \end{equation}
\end{itemize}

\textbf{Assume}
\begin{itemize}
    \item $g_{i,t}$ is independent of $I_t$, $\forall i\in[K]$.
    \item If $g_{i,t}$ is independent of $I_1, \dots, I_{t-1}$ as well,
        it is called \textbf{oblivious}.
        Otherwise, the adversarial is called \textbf{non-oblivious}.
        Note that for non-oblivious adversarial, pseudo-regret is not well-defined.
        We consider oblivious adversarial.
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Exponential Weights for Exploration and Exploitation} %2.1

\begin{alg}[Exp3] \leavevmode
    \begin{framed}
        \begin{algorithmic}
            \State Let $p_1=\big(\frac{1}{K},\dots,\frac{1}{K}\big)$,
                and $\tilde L_{i,0}=0, \forall i\in [K]$
            \For{$t=1,\dots,n$}
                \State Play arm $I_t\sim p_t$
                \State Observe loss $l_{I_t, t}$
                \State $\tilde l_{i,t}:=\frac{l_{i,t}}{p_{i,t}}\doubleone[I_t=t], \forall i\in[K]$
                \State $\tilde L_{i,t} := \tilde L_{i,t-1} + \tilde l_{i,t}, \forall i\in[K]$
                \State $p_{i,t+1}:=\frac{\exp(-\eta_t\tilde L_{i,t})}{\sum_{k=1}^K \exp(-\eta_t\tilde L_{k,t})}, \forall i\in[K]$
                \State $p_{t+1} := (p_{1,t+1},\dots,p_{K,t+1})$
            \EndFor
        \end{algorithmic}
    \end{framed}
\end{alg}

\begin{thm}
    Let $\eta_t:=\sqrt{\frac{\ln K}{tK}}$, then the pseudo-regret
    \begin{equation}
        \Rbar_n\le \frac{\sqrt{17}}{2}\sqrt{nK\ln K}.
    \end{equation}
\end{thm}
\begin{proof}
    Let $\eta_0:=\eta_1=\sqrt{\frac{\ln K}{K}},$
    then for $t\ge1$,
    \begin{align}
        l_{I_t,t}
            &= E_{i\sim p_t}\tilde l_{i,t} \\
            &= E_{i\sim p_t}\tilde l_{i,t}
                +\frac{1}{\eta_{t-1}}\ln E_{i\sim p_t}e^{-\eta_{t-1}\tilde l_{i,t}}
                -\frac{1}{\eta_{t-1}}\ln E_{i\sim p_t}e^{-\eta_{t-1}\tilde l_{i,t}}\\
            &\le  E_{i\sim p_t}\tilde l_{i,t}
                +\frac{1}{\eta_{t-1}} E_{i\sim p_t}[e^{-\eta_{t-1}\tilde l_{i,t}} - 1]
                -\frac{1}{\eta_{t-1}}\ln E_{i\sim p_t}e^{-\eta_{t-1}\tilde l_{i,t}}\\
            &\le E_{i\sim p_t}\tilde l_{i,t}
                +\frac{1}{\eta_{t-1}} E_{i\sim p_t}\bigg[-\eta_{t-1}\tilde l_{i,t}+\frac{\eta_{t-1}^2\tilde l_{i,t}^2}{2}\bigg]
                -\frac{1}{\eta_{t-1}}\ln E_{i\sim p_t}e^{-\eta_{t-1}\tilde l_{i,t}}\\
            &= E_{i\sim p_t}\bigg[\frac{\eta_{t-1}\tilde l_{i,t}^2}{2}\bigg]
                -\frac{1}{\eta_{t-1}}\ln E_{i\sim p_t}e^{-\eta_{t-1}\tilde l_{i,t}}\\
            &\le \frac{\eta_{t-1}}{2p_{I_t,t}}
                -\frac{1}{\eta_{t-1}}\ln E_{i\sim p_t}e^{-\eta_{t-1}\tilde l_{i,t}}\\
            &= \frac{\eta_{t-1}}{2p_{I_t,t}}
                -\frac{1}{\eta_{t-1}}\ln \frac{\sum_{i=1}^K e^{-\eta_{t-1}\tilde L_{i,t-1}}e^{-\eta_{t-1}\tilde l_{i,t}}}{\sum_{i=1}^K e^{-\eta_{t-1}\tilde L_{i,t-1}}} \\
            &= \frac{\eta_{t-1}}{2p_{I_t,t}}
                -\frac{1}{\eta_{t-1}}\ln \frac{\sum_{i=1}^K e^{-\eta_{t-1}\tilde L_{i,t}}}{\sum_{i=1}^K e^{-\eta_{t-1}\tilde L_{i,t-1}}} \\
            &= \frac{\eta_{t-1}}{2p_{I_t,t}} + \Phi_{t-1}(\eta_{t-1}) - \Phi_t(\eta_{t-1}),
    \end{align}
    where
    \begin{equation}
        \Phi_t(\eta):= \frac{1}{\eta}\ln\frac{1}{K} \sum_{i=1}^K e^{-\eta\tilde L_{i,t}}.
    \end{equation}
    So,
    \begin{align}
        \sum_{t=1}^n l_{I_t, t} - \sum_{t=1}^n l_{k,t}
            &= \sum_{t=1}^n E_{i\sim p_t}\tilde l_{i,t} - \sum_{t=1}^n E_{I_t\sim p_t}\tilde l_{k,t} \\
            &\le \sum_{t=1}^n \bigg(\frac{\eta_{t-1}}{2p_{I_t,t}} + \Phi_{t-1}(\eta_{t-1}) - \Phi_t(\eta_{t-1})\bigg)
                - \sum_{t=1}^n E_{I_t\sim p_t}\tilde l_{k,t} \\
    \end{align}
    By the rule of conditional expectations,
    \begin{align}
        E\sum_{t=1}^n \frac{\eta_{t-1}}{2p_{I_t,t}}
            = E\sum_{t=1}^n E_{I_t\sim p_t}\frac{\eta_{t-1}}{2p_{I_t,t}}
            = \frac{K}{2}\sum_{t=1}^n\eta_{t-1}.
    \end{align}
    By Abel summation,
    \begin{align}
        \sum_{t=1}^n ( \Phi_{t-1}(\eta_{t-1}) - \Phi_t(\eta_{t-1}))
            &= \Phi_0(\eta_0) + \sum_{t=1}^{n-1} ( \Phi_t(\eta_t) - \Phi_t(\eta_{t-1})) -\Phi_n(\eta_{n-1}).
    \end{align}
    By definition, $\Phi_0(\eta_0)=0$. Note that
    \begin{align}
        -\Phi_n(\eta_{n-1})
            &= \frac{\ln K}{\eta_{n-1}} - \frac{1}{\eta_{n-1}}\ln \sum_{i=1}^K e^{-\eta_{n-1}\tilde L_{i,n}} \\
            &\le \frac{\ln K}{\eta_{n-1}} - \frac{1}{\eta_{n-1}}\ln e^{-\eta_{n-1}\tilde L_{k,n}} \\
            &= \frac{\ln K}{\eta_{n-1}} + \sum_{t=1}^n \tilde l_{k,t}.
    \end{align}
    So,
    \begin{align}
        E\sum_{t=1}^n l_{I_t, t} - E\sum_{t=1}^n l_{k,t}
            &\le \frac{K}{2}\sum_{t=1}^n\eta_{t-1} + \frac{\ln K}{\eta_{n-1}}
                + E\sum_{t=1}^{n-1} ( \Phi_t(\eta_t) - \Phi_t(\eta_{t-1})) \\
            &\le  \frac{K}{2}\eta_0 + \frac{K}{2} \int_0^{n-1}\eta_t dt + \frac{\ln K}{\eta_{n-1}}
                + E\sum_{t=1}^{n-1} ( \Phi_t(\eta_t) - \Phi_t(\eta_{t-1})) \\
            &= \frac{1}{2}\sqrt{K\ln K} + 2\sqrt{(n-1)K\ln K}
                + E\sum_{t=1}^{n-1} ( \Phi_t(\eta_t) - \Phi_t(\eta_{t-1})) \\
            &\le \frac{\sqrt{17}}{2}\sqrt{nK\ln K}
                + E\sum_{t=1}^{n-1} ( \Phi_t(\eta_t) - \Phi_t(\eta_{t-1})).
    \end{align}
    The remaining is to show $\Phi_t'(\eta)\ge0$.
    \begin{align}
        \Phi_t'(\eta)
            &= -\frac{1}{\eta^2}\ln\frac{1}{K} \sum_{i=1}^K e^{-\eta\tilde L_{i,t}}
                - \frac{1}{\eta}\frac{\sum_{i=1}^K \tilde L_{i,t}e^{-\eta\tilde L_{i,t}}}{\sum_{i=1}^K e^{-\eta\tilde L_{i,t}}} \\
            &= \frac{1}{\eta^2}\sum_{i=1}^K \frac{e^{-\eta\tilde L_{i,t}}}{\sum_{k=1}^K e^{-\eta\tilde L_{k,t}}}\bigg(
                \ln e^{- \eta \tilde L_{i,t}} - \ln\frac{1}{K} \sum_{k=1}^K e^{-\eta\tilde L_{k,t}}\bigg) \\
            &= \frac{1}{\eta^2}\kl(p_t^\eta, p_1) \\
            &\ge 0,
    \end{align}
    where
    \begin{equation}
        p_t^\eta:=\frac{e^{-\eta\tilde L_{i,t}}}{\sum_{k=1}^K e^{-\eta\tilde L_{k,t}}}.
    \end{equation}
\end{proof}
